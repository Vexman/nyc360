<div class="home-container">
  
  <div class="layout-grid">
    
    <main class="main-content">
      
      <section class="top-section">
        <h1 class="page-title">NYC360 Featured Posts</h1>
        
        <div class="featured-row">
          <div class="feat-card" *ngFor="let post of featuredPosts" [routerLink]="['/public/posts/details', post.id]">
            <img [src]="resolvePostImage(post)" alt="Post Image">
            <div class="overlay">
              <span class="badge-pill" [ngClass]="'cat-'+post.category">{{ getCategoryName(post.category) }}</span>
              <h3>{{ post.title | slice:0:50 }}...</h3>
              <p>{{ getAuthorName(post.author) }}</p>
            </div>
          </div>
        </div>
      </section>

      <section class="hero-section" *ngIf="heroBanner">
        <div class="hero-card" [routerLink]="['/public/posts/details', heroBanner.id]">
          <img [src]="resolvePostImage(heroBanner)" alt="Hero Image">
          <div class="play-icon">
            <i class="bi bi-play-fill"></i>
          </div>
  
          <div class="hero-overlay">
            <h2>{{ heroBanner.title }}</h2>
            <p>{{ heroBanner.content | slice:0:120 }}...</p>
          </div>
        </div>
      </section>

      <div class="category-block" *ngFor="let group of interestGroups">
        <div class="block-header">
          <div class="vertical-bar" [ngClass]="'bar-'+group.category"></div>
          <h2>{{ getCategoryName(group.category) }}</h2>
        </div>
        
        <div class="posts-grid">
          <div class="std-card" *ngFor="let post of group.posts | slice:0:4" [routerLink]="['/public/posts/details', post.id]">
            <div class="img-wrapper">
              <img [src]="resolvePostImage(post)">
              <div class="bottom-gradient">
                <h4>{{ post.title | slice:0:60 }}</h4>
                <small>{{ getCategoryName(post.category) }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="highlights-section" *ngIf="highlightedPosts.length > 0">
        <div class="block-header">
           <div class="vertical-bar" style="background: #29B6F6;"></div>
           <h2>Top Stories</h2>
        </div>

        <div class="horizontal-cards-list">
          <div class="horizontal-card" *ngFor="let post of highlightedPosts" [routerLink]="['/public/posts/details', post.id]">
            
            <div class="h-img-wrapper">
              <span class="h-badge">{{ getCategoryName(post.category) }}</span>
              <img [src]="resolvePostImage(post)" alt="Post Image">
            </div>

            <div class="h-content">
              <h2 class="h-title">{{ post.title }}</h2>
              <p class="h-desc">{{ post.content | slice:0:150 }}...</p>
              
              <div class="h-footer">
                <div class="h-author">
                  <img [src]="getAuthorImage(post.author)" class="auth-img">
                  <span class="auth-name">{{ getAuthorName(post.author) }}</span>
                  <span class="post-time">{{ post.createdAt | date:'shortTime' }}</span>
                </div>
                <span class="read-more">Read More <i class="bi bi-arrow-right"></i></span>
              </div>
            </div>

          </div>
        </div>
      </div>
    </main>

    <aside class="sidebar">
      
      <div class="widget weather">
        <div class="w-head">
          <span class="sun-icon"><i class="bi bi-brightness-high-fill"></i> Today in NYC360</span>
        </div>
        <div class="w-body">
          <div class="temp-box">
            <span class="degree">72Â°</span>
            <span class="desc">Partly Cloudy</span>
          </div>
          <div class="aqi-box">
            <span>AQI:47</span>
            <span class="good">Good</span>
          </div>
        </div>
        
        <div class="alert-item yellow">
          <i class="bi bi-exclamation-triangle-fill"></i>
          <div class="alert-text">
            <strong>Gridlock Alert</strong>
            <span>Midtown traffic moving slow due to UN General Assembly</span>
          </div>
        </div>
        
        <div class="alert-item blue">
          <i class="bi bi-cloud-rain-fill"></i>
          <div class="alert-text">
            <strong>Rain Expected</strong>
            <span>Light showers starting around 4 PM</span>
          </div>
        </div>
      </div>

      <div class="widget">
        <h3>Trending Now</h3>
        
        <div class="tags-container">
          <a *ngFor="let tag of trendingTags; let i = index" 
             [routerLink]="['/public/posts/tags', tag]" 
             class="tag"
             [ngClass]="['green', 'blue', 'pink', 'purple', 'cyan', 'indigo'][i % 6]">
             {{ tag }}
          </a>
          
          <p *ngIf="trendingTags.length === 0" style="font-size: 12px; color: #999;">No trending topics yet.</p>
        </div>
      </div>

      <div class="widget">
        <h3>Communities For You</h3>
        <div class="comm-list">
          <div class="comm-row" *ngFor="let comm of suggestedCommunities">
            <div class="c-avatar">{{ comm.name.charAt(0) | uppercase }}</div>
            <div class="c-info">
              <strong>{{ comm.name }}</strong>
              <span>{{ comm.memberCount || 0 }} members</span>
            </div>
            
            <button class="join-btn" 
                    [class.joined]="comm.isJoined" 
                    (click)="onJoinCommunity(comm)"
                    [disabled]="comm.isLoadingJoin || comm.isJoined">
              <ng-container *ngIf="!comm.isLoadingJoin && !comm.isJoined">
                  <i class="bi bi-plus-lg"></i>
              </ng-container>
              
              <ng-container *ngIf="comm.isLoadingJoin">
                  <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
              </ng-container>
              
              <ng-container *ngIf="comm.isJoined">
                  <i class="bi bi-check-lg"></i>
              </ng-container>
            </button>

          </div>
          
          <div class="comm-row" *ngIf="suggestedCommunities.length === 0">
             <p style="font-size: 12px; color: #999;">No suggestions available.</p>
          </div>
        </div>
      </div>

    </aside>

  </div>

  <div class="toast-container">
    <div class="custom-toast" *ngFor="let toast of toasts" [ngClass]="toast.type" (click)="removeToast(toast.id)">
        <div class="toast-icon">
            <i class="bi bi-check-circle-fill" *ngIf="toast.type === 'success'"></i>
            <i class="bi bi-x-circle-fill" *ngIf="toast.type === 'error'"></i>
            <i class="bi bi-info-circle-fill" *ngIf="toast.type === 'info'"></i>
        </div>
        <div class="toast-content">
            <span>{{ toast.message }}</span>
        </div>
    </div>
  </div>

</div>